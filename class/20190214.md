# 20190214 Django

1. 빈 디렉토리 만들고
2. 가상환경 만듬(pyenv virtualenv 3.6.7 1stws-venv)
3. pyenv local로 현재 디렉토리를 가상환경으로 binding 한다(pyenv local 1ws-venv)
4. pip list시 설치된게 없음
5. 장고 설치(pip install django)
6. django-admin startproject first_workshop .(떄문에 새로운 디렉토리 안만들고 현재 위치에서 만든다)
7. python manage.py startapp home(app을 만들어줘야 한다)
8. 이것저것 작업 후
9. urls.py에 from home import views
10. setting.py에 있는 INSTALLED_APPS에 home 추가하고
11. ALLOWED_HOSTS에도 추가 한 후에 / protocol을 제외한 domain만.
12. urls 와 views에서 이것저것 추가해주자



# django ORM

```python
# id는 생략하면 자동으로 만들어 준다
# 장고에게 청사진 보내는거 하나
# db에 보내는거 하나
# [1],[2] 작업이 migration에서 이루어진다
python manage.py makemigrations
#migrate
python manage.py migrate : 이것저것 뜬다. 실제 db에 저장
#shell : 장고 환경이 유지되면서 db작업 할 수 있음
python manage.py shell
>>> from home.models import Article
>>> a = Article(title="happy", content="hacking")
>>> a.save()
>>> Article.objects.all()
# type queryset list와 유사한데, 객체들이 많이 들어가 있음
>>> Article.objects.first()
>>> Article.objects.first().title
'happy'
>>>
# sqlmigrate
python manage.py sqlmigrate home 0001
BEGIN;
--
-- Create model Article
--
CREATE TABLE "home_article" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" text NOT NULL, "content" text NOT NULL);
COMMIT;
# createsuperuser
python manage.py createsuperuser
```

```python
# models.py
from django.db import models

# Create your models here.
class Article(models.Model):
    title = models.TextField()
    content = models.TextField()
    
```

```python
# 0001_initial.py
# Generated by Django 2.1.7 on 2019-02-14 01:36

from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Article',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.TextField()),
                ('content', models.TextField()),
            ],
        ),
    ]

```

```python
##CRUD operation
$ python manage.py shell
from home.models import Article

#save
a = Article(title="와 여기서도 글 써짐ㅋㅋㅋ", content="짱짱맨이야
a.save()
Article.objects.create(title="hey", content="create") => return querySet 객체
그래도 가능한 .save를 쓰는 게 좋다(몇몇 예외 상황이 발생할 수 있기 때문)
            
Article.objects.all()
            
확인을 편하게 하기 위해서 __repr__을 수정 하여 작업 한 다음 shell 을 재실행 하면 됨.
models를 변경하지만, data 부분을 건드리는게 아닌 객체 부분을 건드리기 때문에 다시 migration을 할 필요가 없다.
# select_1            
Article.objects.filter(title="happy").all()
SELECT * FROM Article Where title="happy"
return Value는 QuerySet
            
Article.objects.filter(title="happy").count()
data 개수 반환 => len과 유사
# select_2            
Article.objects.filter(content="hacking").first()
SELECT * FROM Article Where content="hacking" limit=1

Article.objects.get(id=1) => filter ~ .first()와 유사한 역할을 한다맨이야
Article.objects.get(title="happy")

SELECT * FROM Article Where id = 1 limit=1
            
# UPDATE
a= Article.objects.get(id=1)
a.content = "HappyThursday"
a.save()

# DELETE
a = Article.objects.get(id=2)
a.delete()

# ASC/DESC
Article.objects.order_by('id').all()
Article.objects.order_by('-id').all()
뽑고나서 reverse 해도 되지만, 성능이 db에서 하는게 더 나은 경우가 많음

# index 접근도 가능하다
Article.objects.all()[0]
Article.objects.all()[::-1]
Article.objects.all()[1:3]
```

